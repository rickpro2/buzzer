<!DOCTYPE html>
<html>
<head>
  <title>Player Join</title>
  <link rel="stylesheet" href="style.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>

  <!-- JOIN SCREEN -->
  <div id="joinScreen">
    <h2>Enter your name</h2>
    <input id="nameInput" style="padding:10px;font-size:20px;" />

    <h2>Select your team</h2>
    <select id="teamSelect" style="font-size:20px;padding:10px;width:80%"></select>

    <br><br>
    <button id="joinBtn" style="font-size:20px;padding:10px 20px;">Join Game</button>
  </div>

  <!-- BUZZER SCREEN -->
  <div id="buzzScreen" style="display:none;">
    <h2 id="status">Waiting for host...</h2>
    <button id="buzzBtn" class="buzz-button" disabled>BUZZ</button>
  </div>


<script>
const socket = io();

// DOM references
const joinScreen = document.getElementById("joinScreen");
const buzzScreen = document.getElementById("buzzScreen");
const statusText = document.getElementById("status");
const buzzBtn = document.getElementById("buzzBtn");
const teamSelect = document.getElementById("teamSelect");

let localPlayer = null;

// Receive the current team list
socket.on("teamList", (teams) => {
  teamSelect.innerHTML = teams
    .map(t => `<option value="${t}">${t}</option>`)
    .join("");
});

// Join button
document.getElementById("joinBtn").onclick = () => {
  const name = document.getElementById("nameInput").value.trim();
  const team = teamSelect.value;

  if (!name) return;

  localPlayer = { name, team };

  socket.emit("join", { name, team });

  joinScreen.style.display = "none";
  buzzScreen.style.display = "block";
};

// BUZZ BUTTON PRESSED
buzzBtn.onclick = () => {
  buzzBtn.style.background = "#009900";   // Green = YOU buzzed
  buzzBtn.style.color = "#fff";
  socket.emit("buzz");
};

// GAME STATES FROM SERVER
socket.on("armed", () => {
  statusText.textContent = "BUZZ NOW!";
  buzzBtn.disabled = false;
  buzzBtn.style.background = "#d40000"; // Red = ready
  buzzBtn.style.color = "#fff";
});

socket.on("winner", (player) => {
  const isMe = localPlayer && player.name === localPlayer.name && player.team === localPlayer.team;

  statusText.textContent = `${player.team} – ${player.name} buzzed first!`;

  if (isMe) {
    // ⭐ YOU pressed first = button stays green
    buzzBtn.style.background = "#009900";
    buzzBtn.style.color = "white";
  } else {
    // ⭐ Someone else won = button goes dark gray (locked)
    buzzBtn.style.background = "#444";
    buzzBtn.style.color = "#ccc";
  }

  buzzBtn.disabled = true;
});

socket.on("reset", () => {
  statusText.textContent = "Waiting for host...";
  buzzBtn.disabled = true;
  buzzBtn.style.background = "#555"; // Gray = waiting / locked
  buzzBtn.style.color = "#ccc";
});
</script>

</body>
</html>
