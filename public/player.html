<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Game Buzzer</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{font-family:system-ui;background:#111;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0}
.container{width:420px;background:#1b1b1b;padding:2rem;border-radius:16px;text-align:center}
input,select{width:100%;padding:.75rem;margin-bottom:1rem;border-radius:8px;border:none;background:#222;color:#fff}
#buzzBtn{width:260px;height:260px;border-radius:50%;font-size:2rem;border:none;background:#555;color:#ccc}
#buzzBtn.armed{background:#d40000;color:#fff}
#buzzBtn.locked{background:#333;color:#777}
#error{color:#ff7777;margin-bottom:1rem}
</style>
</head>

<body>
<div class="container">

<div id="join">
  <div id="error"></div>
  <input id="pinInput" placeholder="Room PIN">
  <input id="nameInput" placeholder="Your Name">
  <select id="teamSelect" disabled>
    <option>Enter PIN first</option>
  </select>
  <button onclick="checkRoom()">Next</button>
  <button onclick="join()">Join Game</button>
</div>

<div id="buzz" style="display:none;">
  <div id="status">Waitingâ€¦</div>
  <button id="buzzBtn" disabled>BUZZ</button>
</div>

</div>

<script>
const socket = io();
let pin=null;

const teamSelect=document.getElementById("teamSelect");
const errorBox=document.getElementById("error");

function checkRoom(){
  pin=document.getElementById("pinInput").value.trim();
  if(!pin) return;
  socket.emit("checkRoom",pin);
}

socket.on("roomInfo",({teamMode,teams})=>{
  teamSelect.disabled=!teamMode;
  teamSelect.innerHTML=teamMode
    ? teams.map(t=>`<option>${t}</option>`).join("")
    : `<option>Solo</option>`;
});

function join(){
  const name=document.getElementById("nameInput").value.trim();
  if(!name) return;
  socket.emit("joinRoom",{
    pin,
    name,
    team:teamSelect.value
  });
}

socket.on("joinError",msg=>errorBox.textContent=msg);

socket.on("playerList",()=>{
  document.getElementById("join").style.display="none";
  document.getElementById("buzz").style.display="block";
});

const btn=document.getElementById("buzzBtn");
btn.onclick=()=>socket.emit("buzz",pin);

socket.on("armed",()=>{
  btn.disabled=false;
  btn.className="armed";
});

socket.on("winner",()=>{
  btn.disabled=true;
  btn.className="locked";
});

socket.on("roomExpired",()=>{
  alert("Game ended due to inactivity");
  location.reload();
});
</script>
</body>
</html>
