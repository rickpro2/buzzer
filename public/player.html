<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Game Buzzer</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #111;
  color: #f5f5f5;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.container {
  width: 420px;
  background: #1b1b1b;
  padding: 2rem;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}

input, select {
  width: 100%;
  padding: .75rem;
  margin-bottom: 1rem;
  border-radius: 8px;
  border: none;
  background: #222;
  color: #fff;
}

button {
  width: 100%;
  padding: .75rem;
  border-radius: 999px;
  border: none;
  font-weight: 700;
  cursor: pointer;
}

#error {
  color: #ff7777;
  margin-bottom: 1rem;
}

/* ===== BUZZER ===== */
#buzzBtn {
  width: 240px;
  height: 240px;
  border-radius: 50%;
  font-size: 2rem;
  border: none;
  background: #555;
  color: #ccc;
  margin: 1rem auto;
  display: block;
}
#buzzBtn.armed { background: #d40000; color: #fff; }
#buzzBtn.locked { background: #333; color: #777; }

/* ===== SCOREBOARD ===== */
.scoreboard {
  margin-top: 1.5rem;
  background: #222;
  border-radius: 14px;
  padding: 1rem;
  border: 1px solid #333;
}

.scoreboard h3 {
  margin: 0 0 0.75rem 0;
  font-size: 1.1rem;
  color: #ffd86b;
}

.scoreRow {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #1f1f1f;
  border: 1px solid #333;
  border-radius: 10px;
  padding: 0.6rem 0.75rem;
  margin-bottom: 0.5rem;
}

.scoreRow:last-child {
  margin-bottom: 0;
}

.scoreName {
  font-weight: 700;
}

.scoreValue {
  font-weight: 900;
  font-size: 1.1rem;
}
</style>
</head>

<body>
<div class="container">

<!-- ===== JOIN SCREEN ===== -->
<div id="join">
  <div id="error"></div>
  <input id="pinInput" placeholder="Room PIN">
  <input id="nameInput" placeholder="Your Name">
  <select id="teamSelect" disabled>
    <option>Enter PIN first</option>
  </select>
  <button onclick="checkRoom()">Next</button>
  <button onclick="join()" style="margin-top:8px;">Join Game</button>
</div>

<!-- ===== GAME SCREEN ===== -->
<div id="game" style="display:none;">
  <div id="status">Waiting for host…</div>

  <button id="buzzBtn" disabled>BUZZ</button>

  <!-- SCOREBOARD -->
  <div class="scoreboard">
    <h3>Scoreboard</h3>
    <div id="scores">
      <div style="color:#999;font-size:0.9rem;">Waiting for scores…</div>
    </div>
  </div>
</div>

</div>

<script>
const socket = io();
let pin = null;

// UI refs
const teamSelect = document.getElementById("teamSelect");
const errorBox = document.getElementById("error");
const scoresEl = document.getElementById("scores");
const buzzBtn = document.getElementById("buzzBtn");

// STEP 1: Check room to load teams
function checkRoom() {
  pin = document.getElementById("pinInput").value.trim();
  if (!pin) return;
  socket.emit("checkRoom", pin);
}

socket.on("roomInfo", ({ teamMode, teams }) => {
  teamSelect.disabled = !teamMode;
  teamSelect.innerHTML = teamMode
    ? teams.map(t => `<option>${t}</option>`).join("")
    : `<option>Solo</option>`;
});

// STEP 2: Join room
function join() {
  const name = document.getElementById("nameInput").value.trim();
  if (!name) return;

  socket.emit("joinRoom", {
    pin,
    name,
    team: teamSelect.value
  });
}

// Errors
socket.on("joinError", msg => {
  errorBox.textContent = msg;
});

// Joined successfully
socket.on("playerList", () => {
  document.getElementById("join").style.display = "none";
  document.getElementById("game").style.display = "block";
});

// BUZZ logic
buzzBtn.onclick = () => socket.emit("buzz", pin);

socket.on("armed", () => {
  buzzBtn.disabled = false;
  buzzBtn.className = "armed";
  document.getElementById("status").textContent = "BUZZ NOW!";
});

socket.on("winner", () => {
  buzzBtn.disabled = true;
  buzzBtn.className = "locked";
});

// SCOREBOARD (read-only)
socket.on("scoreUpdate", (scores) => {
  scoresEl.innerHTML = "";
  const keys = Object.keys(scores || {});
  if (keys.length === 0) {
    scoresEl.innerHTML =
      `<div style="color:#999;font-size:0.9rem;">No scores yet</div>`;
    return;
  }

  keys.forEach(k => {
    const row = document.createElement("div");
    row.className = "scoreRow";
    row.innerHTML = `
      <div class="scoreName">${k}</div>
      <div class="scoreValue">${scores[k]}</div>
    `;
    scoresEl.appendChild(row);
  });
});

// Room expired
socket.on("roomExpired", () => {
  alert("Game ended due to inactivity.");
  location.reload();
});
</script>
</body>
</html>
