<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Buzzer</title>

  <script src="/socket.io/socket.io.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      max-width: 500px;
      width: 100%;
      padding: 2rem;
      background: #1b1b1b;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    h1 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 1.2rem;
    }

    /* STATUS BAR */
    .status {
      text-align: center;
      font-size: 1.2rem;
      padding: 0.75rem 1rem;
      border-radius: 999px;
      background: #222;
      margin-bottom: 1.5rem;
      transition: 0.3s ease;
    }
    .status.armed {
      background: #004d17;
      color: #c7ffd1;
    }
    .status.winner {
      background: #4d0000;
      color: #ffd5d5;
    }

    /* INPUTS */
    input, select {
      width: 100%;
      font-size: 1rem;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border: none;
      outline: none;
      background: #222;
      color: #fff;
    }

    /* JOIN BUTTON */
    #joinBtn {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      width: 100%;
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      background: #00af3f;
      color: #fff;
      transition: 0.3s ease;
      margin-bottom: 1rem;
    }

    /* ------------------------------ */
    /*    CIRCULAR BUZZER BUTTON      */
    /* ------------------------------ */
    #buzzBtn {
      background: #555;     /* Waiting */
      color: #ccc;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      font-size: 2rem;
      font-weight: bold;
      border: none;
      margin: 0 auto;
      display: block;
      transition: 0.25s ease;
      box-shadow: 
        0 0 20px rgba(0,0,0,0.5),
        inset 0 0 20px rgba(0,0,0,0.6);
    }

    /* READY TO BUZZ */
    #buzzBtn.armed {
      background: #d40000;
      color: #fff;
      box-shadow:
        0 0 30px rgba(255,0,0,0.5),
        inset 0 0 20px rgba(255,255,255,0.2);
    }

    /* YOU BUZZED FIRST */
    #buzzBtn.you {
      background: #009900 !important;
      color: #fff;
      box-shadow:
        0 0 40px rgba(0,255,0,0.5),
        inset 0 0 20px rgba(255,255,255,0.3);
    }

    /* SOMEONE ELSE BUZZED FIRST */
    #buzzBtn.locked {
      background: #333 !important;
      color: #777;
      box-shadow: none;
    }
  </style>
</head>

<body>

<div class="container">

  <!-- JOIN SCREEN -->
  <div id="joinScreen">
    <h1>Join Game</h1>

    <input id="nameInput" placeholder="Your Name" />

    <select id="teamSelect"></select>

    <button id="joinBtn">Join Game</button>
  </div>

  <!-- BUZZER SCREEN -->
  <div id="buzzScreen" style="display:none;">
    <h1>Buzzer</h1>

    <div id="status" class="status">Waiting for host...</div>

    <button id="buzzBtn" disabled>BUZZ</button>
  </div>

</div>

<script>
const socket = io();

let localPlayer = null;

// UI references
const joinScreen = document.getElementById("joinScreen");
const buzzScreen = document.getElementById("buzzScreen");
const statusBox = document.getElementById("status");
const buzzBtn = document.getElementById("buzzBtn");
const teamSelect = document.getElementById("teamSelect");

// Receive team list from host
socket.on("teamList", (teams) => {
  teamSelect.innerHTML = teams
    .map(t => `<option value="${t}">${t}</option>`)
    .join("");
});

// Join game
document.getElementById("joinBtn").onclick = () => {
  const name = document.getElementById("nameInput").value.trim();
  const team = teamSelect.value;

  if (!name) return alert("Enter your name.");

  localPlayer = { name, team };

  socket.emit("join", { name, team });

  joinScreen.style.display = "none";
  buzzScreen.style.display = "block";
};

// Press BUZZ
buzzBtn.onclick = () => {
  buzzBtn.classList.remove("armed");
  buzzBtn.classList.add("you");
  socket.emit("buzz");
};

// HOST ARMED BUZZERS
socket.on("armed", () => {
  statusBox.textContent = "BUZZ NOW!";
  statusBox.className = "status armed";

  buzzBtn.disabled = false;
  buzzBtn.classList.add("armed");
  buzzBtn.classList.remove("locked", "you");
});

// SOMEONE BUZZED FIRST
socket.on("winner", (player) => {
  const isMe =
    localPlayer &&
    localPlayer.name === player.name &&
    localPlayer.team === player.team;

  statusBox.textContent = `${player.team} â€“ ${player.name} buzzed first!`;
  statusBox.className = "status winner";

  if (isMe) {
    buzzBtn.classList.add("you");
  } else {
    buzzBtn.classList.add("locked");
  }

  buzzBtn.disabled = true;
  buzzBtn.classList.remove("armed");
});

// HOST RESET
socket.on("reset", () => {
  statusBox.textContent = "Waiting for host...";
  statusBox.className = "status";

  buzzBtn.disabled = true;
  buzzBtn.className = "";
});
</script>

</body>
</html>
