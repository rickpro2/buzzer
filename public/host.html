<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Host Control Panel</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#111;
  color:#f5f5f5;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.container {
  max-width:900px;
  width:95%;
  background:#1b1b1b;
  padding:2rem;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
}
h1 { text-align:center; }

.status {
  text-align:center;
  padding:.8rem;
  border-radius:999px;
  background:#222;
  margin-bottom:1.5rem;
}
.status.armed { background:#004d17; color:#c7ffd1; }
.status.winner { background:#4d0000; color:#ffd5d5; }

.toggle {
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:1.5rem;
}

input {
  width:100%;
  padding:.75rem;
  border-radius:10px;
  border:none;
  background:#222;
  color:#fff;
}

button {
  cursor:pointer;
  border:none;
  border-radius:999px;
  padding:.8rem 2rem;
  font-weight:600;
}

#armBtn { background:#00af3f; color:white; }
#resetBtn { background:#444; color:#eee; }

.teamBlock {
  background:#222;
  padding:1rem;
  margin-top:1rem;
  border-radius:12px;
}
.teamBlock h3 { color:#ffd86b; }
.player { background:#333; padding:.5rem; border-radius:6px; margin:.3rem 0; }

.controls {
  display:flex;
  justify-content:center;
  gap:1rem;
  margin-top:1.5rem;
}
</style>
</head>

<body>
<div class="container">

<h1>Host Panel</h1>

<div id="status" class="status">Waiting to arm buzzers…</div>

<div class="toggle">
  <label>Team Mode</label>
  <input type="checkbox" id="teamToggle" checked>
</div>

<input id="teamInput" placeholder="Red, Blue, Green">
<button id="setTeamsBtn" style="margin-top:1rem;">Update Teams</button>

<div id="players"></div>

<div class="controls">
  <button id="armBtn">Arm Buzzers</button>
  <button id="resetBtn">Reset</button>
</div>

</div>

<script>
const socket = io();

const statusBox = document.getElementById("status");
const playersDiv = document.getElementById("players");
const teamInput = document.getElementById("teamInput");
const teamToggle = document.getElementById("teamToggle");

teamToggle.onchange = () => socket.emit("toggleTeamMode", teamToggle.checked);
document.getElementById("armBtn").onclick = () => socket.emit("arm");
document.getElementById("resetBtn").onclick = () => socket.emit("reset");
document.getElementById("setTeamsBtn").onclick = () => {
  socket.emit("setTeams",
    teamInput.value.split(",").map(t=>t.trim()).filter(Boolean)
  );
};

socket.on("config", ({teamMode, teams}) => {
  teamToggle.checked = teamMode;
  teamInput.style.display = teamMode ? "block":"none";
  document.getElementById("setTeamsBtn").style.display = teamMode?"block":"none";
  teamInput.value = teams.join(", ");
});

socket.on("playerList", players => {
  let html = "<h2>Players</h2>";
  const grouped = {};
  players.forEach(p => {
    grouped[p.team] = grouped[p.team] || [];
    grouped[p.team].push(p.name);
  });
  for (let t in grouped) {
    html += `<div class="teamBlock"><h3>${t}</h3>`;
    html += grouped[t].map(n=>`<div class="player">${n}</div>`).join("");
    html += "</div>";
  }
  playersDiv.innerHTML = html;
});

socket.on("armed", ()=> {
  statusBox.textContent="Buzzers Armed!";
  statusBox.className="status armed";
});

socket.on("winner", p=> {
  statusBox.textContent = p.team==="Solo"
    ? `${p.name} buzzed first!`
    : `${p.team} – ${p.name} buzzed first!`;
  statusBox.className="status winner";
});

socket.on("reset", ()=> {
  statusBox.textContent="Waiting to arm buzzers…";
  statusBox.className="status";
});
</script>
</body>
</html>
