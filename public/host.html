<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Host Panel</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body {
  font-family:system-ui,sans-serif;
  background:#111;
  color:#f5f5f5;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.container {
  max-width:900px;
  width:95%;
  padding:2rem;
  background:#1b1b1b;
  border-radius:16px;
}
.status {
  text-align:center;
  padding:.8rem;
  border-radius:999px;
  background:#222;
  margin-bottom:1rem;
}
.teamBlock {
  background:#222;
  padding:1rem;
  margin-top:1rem;
  border-radius:12px;
}
.player {
  background:#333;
  padding:.4rem;
  margin:.3rem 0;
  border-radius:6px;
}
button {
  border:none;
  border-radius:999px;
  padding:.7rem 1.5rem;
  font-weight:600;
}
</style>
</head>

<body>
<div class="container">

<h1>Host Control Panel</h1>

<button id="createRoomBtn">Create New Game</button>

<h2 id="roomPin"></h2>

<div class="status" id="status">Waiting…</div>

<label>
  Team Mode
  <input type="checkbox" id="teamToggle" checked>
</label>

<input id="teamInput" placeholder="Red, Blue, Green">
<button id="setTeamsBtn">Update Teams</button>

<div id="players"></div>

<button onclick="socket.emit('arm', currentPin)">Arm</button>
<button onclick="socket.emit('reset', currentPin)">Reset</button>

</div>

<script>
const socket = io();
let currentPin = null;

document.getElementById("createRoomBtn").onclick = () => {
  socket.emit("createRoom");
};

socket.on("roomCreated", ({ pin, config }) => {
  currentPin = pin;
  document.getElementById("roomPin").textContent =
    `Room PIN: ${pin}`;
  socket.emit("joinRoom", { pin });
});

document.getElementById("teamToggle").onchange = e => {
  socket.emit("toggleTeamMode", {
    pin: currentPin,
    enabled: e.target.checked
  });
};

document.getElementById("setTeamsBtn").onclick = () => {
  socket.emit("setTeams", {
    pin: currentPin,
    teams: document.getElementById("teamInput")
      .value.split(",").map(t=>t.trim()).filter(Boolean)
  });
};

socket.on("playerList", players => {
  let html = "<h2>Players</h2>";
  const grouped = {};
  players.forEach(p => {
    grouped[p.team] = grouped[p.team] || [];
    grouped[p.team].push(p.name);
  });
  for (let t in grouped) {
    html += `<div class="teamBlock"><h3>${t}</h3>`;
    html += grouped[t].map(n=>`<div class="player">${n}</div>`).join("");
    html += "</div>";
  }
  document.getElementById("players").innerHTML = html;
});

socket.on("armed", () => {
  document.getElementById("status").textContent = "Buzzers Armed!";
});
socket.on("winner", p => {
  document.getElementById("status").textContent =
    `${p.team} – ${p.name} buzzed first!`;
});
socket.on("reset", () => {
  document.getElementById("status").textContent = "Waiting…";
});

socket.on("roomExpired", () => {
  alert("This room expired due to inactivity.");
  window.location.reload();
});
</script>
</body>
</html>
